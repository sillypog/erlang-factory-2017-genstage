<h2>Processes and back&#8209;pressure</h2>

<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   width="600"
   height="300"
   viewBox="0 0 600.00001 300.00001"
   id="backpressure"
   version="1.1"
   inkscape:version="0.91 r13725"
   sodipodi:docname="backpressure.svg">
  <defs
     id="defs4">
    <marker
       inkscape:stockid="Tail"
       orient="auto"
       refY="0"
       refX="0"
       id="Tail"
       style="overflow:visible"
       inkscape:isstock="true">
      <g
         id="g10816"
         transform="scale(-1.2,-1.2)"
         style="fill:#000000;fill-opacity:1;stroke:#000000;stroke-opacity:1">
        <path
           id="path10818"
           d="M -3.8048674,-3.9585227 0.54352094,0"
           style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.80000001;stroke-linecap:round;stroke-opacity:1"
           inkscape:connector-curvature="0" />
        <path
           id="path10820"
           d="M -1.2866832,-3.9585227 3.0617053,0"
           style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.80000001;stroke-linecap:round;stroke-opacity:1"
           inkscape:connector-curvature="0" />
        <path
           id="path10822"
           d="M 1.3053582,-3.9585227 5.6537466,0"
           style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.80000001;stroke-linecap:round;stroke-opacity:1"
           inkscape:connector-curvature="0" />
        <path
           id="path10824"
           d="M -3.8048674,4.1775838 0.54352094,0.21974226"
           style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.80000001;stroke-linecap:round;stroke-opacity:1"
           inkscape:connector-curvature="0" />
        <path
           id="path10826"
           d="M -1.2866832,4.1775838 3.0617053,0.21974226"
           style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.80000001;stroke-linecap:round;stroke-opacity:1"
           inkscape:connector-curvature="0" />
        <path
           id="path10828"
           d="M 1.3053582,4.1775838 5.6537466,0.21974226"
           style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.80000001;stroke-linecap:round;stroke-opacity:1"
           inkscape:connector-curvature="0" />
      </g>
    </marker>
    <marker
       inkscape:stockid="Arrow2Lend"
       orient="auto"
       refY="0"
       refX="0"
       id="Arrow2Lend"
       style="overflow:visible"
       inkscape:isstock="true">
      <path
         id="path10801"
         style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.625;stroke-linejoin:round;stroke-opacity:1"
         d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
         transform="matrix(-1.1,0,0,-1.1,-1.1,0)"
         inkscape:connector-curvature="0" />
    </marker>
  </defs>
  <sodipodi:namedview
     id="base"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:pageopacity="0.0"
     inkscape:pageshadow="2"
     inkscape:zoom="0.7"
     inkscape:cx="337.09498"
     inkscape:cy="191.48954"
     inkscape:document-units="px"
     inkscape:current-layer="layer1"
     showgrid="false"
     units="px"
     inkscape:window-width="1256"
     inkscape:window-height="672"
     inkscape:window-x="4"
     inkscape:window-y="0"
     inkscape:window-maximized="0" />
  <metadata
     id="metadata7">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title></dc:title>
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g
     inkscape:label="Layer 1"
     inkscape:groupmode="layer"
     id="layer1"
     transform="translate(0,-752.36216)">
    <rect
       style="fill:#add9e4;fill-opacity:1;fill-rule:evenodd;stroke:#74a7cb;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
       id="rect3336"
       width="158.57143"
       height="100"
       x="68.85714"
       y="845.505" />
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:40px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       x="91.508331"
       y="881.2193"
       id="text4138"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         id="tspan4140"
         x="91.508331"
         y="881.2193"
         style="font-size:25px">Producer</tspan></text>
    <rect
       y="845.505"
       x="368.85715"
       height="100"
       width="158.57143"
       id="rect4169"
       style="fill:#add9e4;fill-opacity:1;fill-rule:evenodd;stroke:#74a7cb;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
    <text
       sodipodi:linespacing="125%"
       id="text4171"
       y="881.2193"
       x="383.70804"
       style="font-style:normal;font-weight:normal;font-size:40px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       xml:space="preserve"><tspan
         style="font-size:25px"
         y="881.2193"
         x="383.70804"
         id="tspan4173"
         sodipodi:role="line">Consumer</tspan></text>
    <path
       id="supplyArrow"
       d="m 304.45798,897.42937 0,11.73707 -65.22214,0 0,36.67712 65.22214,0 0,11.73707 26.04637,-15.03809 26.04636,-15.03694 -26.04636,-15.03811 -26.04637,-15.03812 z"
       style="fill:#add9ef;fill-opacity:1;stroke:#74a7cb;stroke-width:1.82299995;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
       inkscape:connector-curvature="0" />
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       x="383.63968"
       y="925.38275"
       id="text11161"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         id="tspan11163"
         x="383.63968"
         y="925.38275">Mailbox</tspan></text>
    <rect
       style="opacity:0.95;fill:#74a7cb;fill-opacity:1;stroke:none;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
       id="mailbox1"
       width="8.5714283"
       height="25.714285"
       x="450"
       y="906.93359"
       inkscape:label="#mailbox1" />
    <g
       id="demandArrow">
      <path
         id="path11261"
         d="m 291.32848,833.42937 0,11.73707 65.22214,0 0,36.67712 -65.22214,0 0,11.73707 -26.04637,-15.03809 -26.04636,-15.03694 26.04636,-15.03811 26.04637,-15.03812 z"
         style="fill:#add9ef;fill-opacity:1;stroke:#74a7cb;stroke-width:1.82299995;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         inkscape:connector-curvature="0" />
      <text
         sodipodi:linespacing="125%"
         id="text11263"
         y="867.79071"
         x="282"
         style="font-style:normal;font-weight:normal;font-size:15px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
         xml:space="preserve"><tspan
           y="867.79071"
           x="282"
           id="tspan11265"
           sodipodi:role="line">Demand</tspan></text>
    </g>
  </g>
</svg>
<p>With back&#8209;pressure</p>

<!-- Notes
Backpressure only solves the overflow problem if the producer controls the rate of production for the entire system, otherwise it just pushes the problem up to the producer. So this system is good where the producer is reading from disk or a queue, not so good when it is a TCP server.

Demand is one mode of GenStage, coming from the default DemandDispatcher. There are also BroadcastDispatcher and PartitionDispatcher.

Alternatives to backpressure include:

- Load-shedding. Just drop some messages. Good luck finding the gold!
- Block on the producer. Instead of casting all messages, every 10_000th message could be a call, which would wait for a response. But in a system that has lots of consumers (where some are fast and some are slow), that might starve some of the more efficient consumers.
-->
